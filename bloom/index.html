<html>
<head>
    <script src="lightgl.js"></script>

    <script id="quadVert" type="text/shader/x-vertex">
    varying vec2 coord;

    void main() {	
        gl_Position = gl_Vertex;
        coord = gl_TexCoord.xy;
    }
    </script>

    <script id="quadFrag" type="text/shader/x-fragment">
    uniform sampler2D tex;
    varying vec2 coord;
    uniform vec2 offset;

    void main (void) {
        gl_FragColor = texture2D(tex, coord);
    }
    </script>

    <script id="reflectVert" type="text/shader/x-vertex">
    uniform vec3 light;
    varying vec3 N, L, R;

    void main() {	
        gl_Position = ftransform();		
        vec3 vVertex = vec3(gl_ModelViewMatrix * gl_Vertex);
        L = normalize(light - vVertex);
        vec4 eyeVec = gl_ProjectionMatrixInverse * vec4(0, 0, -1, 0);
        N = normalize(gl_NormalMatrix * gl_Normal);
        vec3 I = normalize(vVertex - eyeVec.xyz); // Eye to vertex
        R = reflect(I, N);
    }
    </script>

    <script id="reflectFrag" type="text/shader/x-fragment">
    uniform samplerCube cubeMap;
    varying vec3 N, L, R;

    void main (void) {
        vec4 finalColor = textureCube(cubeMap, R);
        float lambert = dot(N, L);
        if (lambert > 0.0) {
            finalColor += textureCube(cubeMap, R);
        }
        gl_FragColor = finalColor;
    }
    </script>

    <script id="refractVert" type="text/shader/x-vertex">
    uniform vec3 light;
    varying vec3 N, L, R;

    void main() {	
        gl_Position = ftransform();		
        vec3 vVertex = vec3(gl_ModelViewMatrix * gl_Vertex);
        L = normalize(light - vVertex);
        vec4 eyeVec = gl_ProjectionMatrixInverse * vec4(0, 0, -1, 0);
        
        N = normalize(gl_NormalMatrix * gl_Normal);
        vec3 I = normalize(vVertex - eyeVec.xyz);
        R = refract(I, N, 0.9);
    }
    </script>

    <script id="refractFrag" type="text/shader/x-fragment">
    uniform samplerCube cubeMap;
    varying vec3 N, L, R;

    void main() {
        vec4 finalColor = textureCube(cubeMap, R);
        float lambertTerm = dot(N, L);
        if(lambertTerm > 0.0) {
            finalColor += textureCube(cubeMap, R);
        }
        gl_FragColor = finalColor;
    }
    </script>

    <script id="blurVert" type="text/shader/x-vertex">
    varying vec2 coord;

    void main() { 
        gl_Position = gl_Vertex;
        coord = gl_TexCoord.xy;
    }
    </script>

    <script id="blurFrag" type="text/shader/x-fragment">
    uniform float intensity;
    uniform vec2 dir;
    uniform sampler2D tex;
    varying vec2 coord;

    void main() {
        float sigma = 10.0 / 3.0;
        float twoSigmaSigma = 2.0 * sigma * sigma;
        float rootSigma = sqrt(twoSigmaSigma * 3.1415);

        vec4 total = vec4(0.0);
        for (float i = -10.0; i <= 10.0; ++i) {
            float c = exp(-i * i / twoSigmaSigma);
            total += c * texture2D(tex, coord + i * dir);
        }

        gl_FragColor = intensity * total / rootSigma;
    }
    </script>

    <script id="brightpassVert" type="text/shader/x-vertex">
    varying vec2 coord;

    void main() {
        gl_Position = gl_Vertex;
        coord = gl_TexCoord.xy;
    }
    </script>

    <script id="brightpassFrag" type="text/shader/x-fragment">
    uniform sampler2D tex;
    varying vec2 coord;
    const vec3 avgVector = vec3(0.299, 0.587, 0.114);

    void main(void) {
        vec4 sample = texture2D(tex, coord);
        float luminance = max(0.0, dot(avgVector, sample.rgb));
        sample.rgb *= sign(luminance - 0.9995);
        gl_FragColor = sample;
    }
    </script>

    <script src="dragon.js"></script>
    <script src="main.js"></script>
</head>
<body>
</body>
</html>
